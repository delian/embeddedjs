(function(l){function g(a){if(!this instanceof g)return new g(a);"string"===typeof a&&(a={template:a});this.options=a||{};return this.refresh()}var m={},k=null;g.prototype.refresh=function(){var a=this,c=a.options;a.cache="undefined"===typeof c.cache?m:c.cache;a.leftBranch=c.leftBranch||"<%";a.rightBranch=c.rightBranch||"%>";a.template="";c.url?a.getUrlCache({url:c.url,success:function(b){a.template=a.compile(b);"function"==typeof c.cb&&c.cb(a)},failure:function(){"function"==typeof c.cb&&c.cb(null)}}):
c.template&&(a.template=a.compile(c.template),"function"==typeof c.cb&&c.cb(a));return a};g.prototype.browserXfer=function(a){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?"function"==typeof a.success&&a.success(c.responseText):"function"==typeof a.failure&&a.failure(null))};c.open(a.method||"GET",a.url);c.send(null);return this};g.prototype.nodeXfer=function(a){if(k)k.readFile(a.url,function(c,b){if(c&&"function"===typeof a.failure)return a.failure();"function"===
typeof a.success&&a.success(b)});else throw"No node fs module!";};g.prototype.getUrlCache=function(a){var c=this,b=a.url;if(this.cache[b])return a.success(this.cache[b]);this.getUrl({url:b,success:function(d){c.cache[b]=d;"function"==typeof a.success&&a.success(d)},failure:function(){c.cache[b]=null;"function"==typeof a.failure&&a.failure()}});return this};g.prototype.compile=function(a){function c(a){a=a.replace(/\\/g,"\\\\");a=a.replace(/\n/g,"\\n");return a=a.replace(/"/g,'\\"')}a=a.replace(/\r\n/g,
"\n").replace(/\r/g,"\n");for(var b,d=a.split(this.leftBranch),e='with (___views || {}) { with(___obj || {}) { var __s = "'+c(d[0])+'";',f=1;f<d.length;f++){b=d[f].indexOf(this.rightBranch);0<=b?(a=d[f].substr(0,b),b=d[f].substr(b+this.rightBranch.length)):(a=d[f],b="");switch(a.substr(0,1)){case "=":e+="__s+"+a+";";break;default:e+=a}e+='__s+="'+c(b)+'";'}e+=" } }; return __s;";console.log("Compiled",e);return new Function("___obj","___views",e)};g.prototype.render=function(a){"string"==typeof a&&
(a={value:a});return this.template(a,this.views)};g.prototype.update=function(a,c){var b=document.getElementById(a);b&&("string"===typeof c?this.getUrlCache({url:c,success:function(a){b.innerHTML(JSON.parse(a))}}):b.innerHTML=this.template(c,this.views));return this};g.prototype.views={link_tag:function(a){return'<A HREF="'+a+'">'},date_tag:function(a,c,b){c instanceof Date||(c=new Date);var d="January February March April May June July August September October November December".split(" "),e=[],
f=[];b=[];var g=c.getFullYear(),k=c.getMonth();c=c.getDate();for(var h=g-15;h<g+15;h++)e.push({value:h,text:h});for(h=0;12>h;h++)f.push({value:h,text:d[h]});for(d=0;31>d;d++)b.push({value:d+1,text:d+1});e=this.select_tag(a+"[year]",g,e,{id:a+"[year]"});f=this.select_tag(a+"[month]",k,f,{id:a+"[month]"});a=this.select_tag(a+"[day]",c,b,{id:a+"[day]"});return e+f+a},form_tag:function(a,c){c=c||{};c.action=a;!0==c.multipart&&(c.method="post",c.enctype="multipart/form-data");return this.start_tag_for("form",
c)},form_tag_end:function(){return this.tag_end("form")},hidden_field_tag:function(a,c,b){return this.input_field_tag(a,c,"hidden",b)},input_field_tag:function(a,c,b,d){d=d||{};d.id=d.id||a;d.value=c||"";d.type=b||"text";d.name=a;return this.single_tag_for("input",d)},is_current_page:function(a){return window.location.href==a||window.location.pathname==a?!0:!1},link_to:function(a,c,b){a||(a="null");b||(b={});b.confirm&&(b.onclick=' var ret_confirm = confirm("'+b.confirm+'"); if(!ret_confirm){ return false;} ',
b.confirm=null);b.href=c;return this.start_tag_for("a",b)+a+this.tag_end("a")},submit_link_to:function(a,c,b){a||(a="null");b||(b={});b.onclick=b.onclick||"";b.confirm&&(b.onclick=' var ret_confirm = confirm("'+b.confirm+'"); if(!ret_confirm){ return false;} ',b.confirm=null);b.value=a;b.type="submit";b.onclick=b.onclick+(c?this.url_for(c):"")+"return false;";return this.start_tag_for("input",b)},link_to_if:function(a,c,b,d,e,f){return this.link_to_unless(!1==a,c,b,d,e,f)},link_to_unless:function(a,
c,b,d,e){d=d||{};return a?e&&"function"==typeof e?e(c,b,d,e):c:this.link_to(c,b,d)},link_to_unless_current:function(a,c,b,d){b=b||{};return this.link_to_unless(this.is_current_page(c),a,c,b,d)},password_field_tag:function(a,c,b){return this.input_field_tag(a,c,"password",b)},select_tag:function(a,c,b,d){d=d||{};d.id=d.id||a;d.value=c;d.name=a;a=""+this.start_tag_for("select",d);for(d=0;d<b.length;d++){var e=b[d],f={value:e.value};e.value==c&&(f.selected="selected");a+=this.start_tag_for("option",
f)+e.text+this.tag_end("option")}return a+=this.tag_end("select")},single_tag_for:function(a,c){return this.tag(a,c,"/>")},start_tag_for:function(a,c){return this.tag(a,c)},submit_tag:function(a,c){c=c||{};c.type=c.type||"submit";c.value=a||"Submit";return this.single_tag_for("input",c)},tag:function(a,c,b){var d;b||(b=">");var e=" ",f;for(f in c)d=null!=c[f]?c[f].toString():"","Class"==f&&(f="class"),e=-1!=d.indexOf("'")?e+(f+'="'+d+'" '):e+(f+"='"+d+"' ");return"<"+a+e+b},tag_end:function(a){return"</"+
a+">"},text_area_tag:function(a,c,b){b=b||{};b.id=b.id||a;b.name=b.name||a;c=c||"";b.size&&(b.cols=b.size.split("x")[0],b.rows=b.size.split("x")[1],delete b.size);b.cols=b.cols||50;b.rows=b.rows||4;return this.start_tag_for("textarea",b)+c+this.tag_end("textarea")},text_field_tag:function(a,c,b){return this.input_field_tag(a,c,"text",b)},url_for:function(a){return'window.location="'+a+'";'},img_tag:function(a,c,b){b=b||{};b.src=a;b.alt=c;return this.single_tag_for("img",b)}};"undefined"!==typeof module&&
module.exports?(module.exports=g,l.EJS=g,g.prototype.getUrl=g.prototype.nodeXfer,k=require("fs")):("undefined"!==typeof define&&"undefined"!==typeof requirejs?define(function(a,c,b){return g}):l.EJS=g,g.prototype.getUrl=g.prototype.browserXfer)})(this);
